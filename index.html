<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astrocartography Map Generator</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Astrocartography Map</h1>
            <p>Discover where the planets align for you around the world</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h2>Birth Information</h2>
                
                <div class="form-group">
                    <label>üìÖ Birth Date</label>
                    <input type="date" id="birthDate" value="1986-07-31" required>
                </div>

                <div class="form-group">
                    <label>‚è∞ Birth Time (Local)</label>
                    <input type="time" id="birthTime" value="13:30" step="1" required>
                </div>

                <div class="form-group">
                    <label>üìç Birth Location</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="text" id="birthLocation" value="Istanbul" placeholder="City, Country" required style="flex: 1;">
                        <button type="button" id="geocodeBtn" style="padding: 12px 15px; background: linear-gradient(45deg, #28a745 0%, #20c997 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 0.9rem;">üìç</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Latitude</label>
                    <input type="number" id="birthLat" value="41.016667" step="0.0001" placeholder="e.g., 40.7128" required>
                </div>

                <div class="form-group">
                    <label>Longitude</label>
                    <input type="number" id="birthLon" value="28.950000" step="0.0001" placeholder="e.g., -74.0060" required>
                </div>

                <div class="form-group">
                    <label>Timezone Offset (hours from UTC)</label>
                    <input type="number" id="tzOffset" value="3" step="0.5" placeholder="e.g., -5" required>
                </div>

                <button class="btn" id="generateBtn">Generate Map</button>
                <button class="btn" id="shareBtn" style="margin-top: 10px; background: linear-gradient(45deg, #28a745 0%, #20c997 100%);">Share Map</button>

                <div class="legend" id="legend" style="display: none;">
                    <h3>Planetary Lines</h3>
                    <div class="legend-grid">
                        <div class="line-type">
                            <strong>AC</strong>
                            <span>Ascendant Rising Line</span>
                        </div>
                        <div class="line-type">
                            <strong>DC</strong>
                            <span>Descendant Setting Line</span>
                        </div>
                        <div class="line-type">
                            <strong>MC</strong>
                            <span>Midheaven Culmination</span>
                        </div>
                        <div class="line-type">
                            <strong>IC</strong>
                            <span>Imum Coeli Lower Culmination</span>
                        </div>
                    </div>
                    
                    <div class="planet-list" id="planetList"></div>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
                
                <div class="info-box" id="infoBox" style="display: none;">
                    <h4>About Your Astrocartography Map</h4>
                    <p>
                        Your astrocartography map shows planetary lines across the world. Each line represents 
                        where a planet was on a specific angle (AC/DC/MC/IC) at your time of birth. Locations near these 
                        lines may have special significance for you, influencing different life areas depending on the 
                        planet and angle. Hover over any line to see details about that planetary influence.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>


        var planets = [
            { name: 'Sun', color: '#FFD700', symbol: '‚òâ' },
            { name: 'Moon', color: '#C0C0C0', symbol: '‚òΩ' },
            { name: 'Mercury', color: '#87CEEB', symbol: '‚òø' },
            { name: 'Venus', color: '#FF69B4', symbol: '‚ôÄ' },
            { name: 'Mars', color: '#FF4500', symbol: '‚ôÇ' },
            { name: 'Jupiter', color: '#FFA500', symbol: '‚ôÉ' },
            { name: 'Saturn', color: '#8B4513', symbol: '‚ôÑ' },
            { name: 'Uranus', color: '#40E0D0', symbol: '‚ôÖ' },
            { name: 'Neptune', color: '#4169E1', symbol: '‚ôÜ' },
            { name: 'Pluto', color: '#8A2BE2', symbol: '‚ôá' }
        ];

        var lineTypes = ['AC', 'DC', 'MC', 'IC'];
        var currentLines = [];

        var interpretations = {
            'Sun': {
                'AC': 'Strong personal identity, leadership qualities, vitality and self-expression are enhanced.',
                'DC': 'Attracts confident partners, focus on relationships and collaboration.',
                'MC': 'Career recognition, authority positions, public visibility and success.',
                'IC': 'Strong family connections, sense of home and personal foundation.'
            },
            'Moon': {
                'AC': 'Emotional sensitivity, intuitive abilities, nurturing and protective instincts.',
                'DC': 'Seeks emotional security in partnerships, caring relationships.',
                'MC': 'Public service, caregiving professions, emotional connection to career.',
                'IC': 'Deep family roots, emotional home base, ancestral connections.'
            },
            'Mercury': {
                'AC': 'Enhanced communication, intellectual curiosity, quick thinking.',
                'DC': 'Mental connection with others, communicative partnerships.',
                'MC': 'Writing, teaching, media careers, intellectual reputation.',
                'IC': 'Learning environment, family communication, intellectual foundation.'
            },
            'Venus': {
                'AC': 'Personal charm, artistic talents, beauty and harmony.',
                'DC': 'Romantic relationships, artistic partnerships, social connections.',
                'MC': 'Arts, beauty, diplomatic careers, social recognition.',
                'IC': 'Beautiful home environment, family harmony, aesthetic foundation.'
            },
            'Mars': {
                'AC': 'Increased energy, assertiveness, courage and pioneering spirit.',
                'DC': 'Dynamic partnerships, potential for conflict or competition.',
                'MC': 'Military, sports, competitive careers, dynamic leadership.',
                'IC': 'Active home life, family dynamics, energetic foundation.'
            },
            'Jupiter': {
                'AC': 'Optimism, expansion, good fortune and philosophical outlook.',
                'DC': 'Beneficial partnerships, growth through relationships.',
                'MC': 'Teaching, publishing, international business, expansion of reputation.',
                'IC': 'Educational background, expansive family, philosophical foundation.'
            },
            'Saturn': {
                'AC': 'Discipline, responsibility, serious approach to life, delayed rewards.',
                'DC': 'Serious partnerships, commitment, traditional relationships.',
                'MC': 'Corporate careers, authority positions, long-term achievements.',
                'IC': 'Traditional family structure, disciplined foundation, ancestral wisdom.'
            },
            'Uranus': {
                'AC': 'Originality, innovation, independence, unconventional approach.',
                'DC': 'Unusual partnerships, freedom in relationships, unexpected encounters.',
                'MC': 'Technology, innovation, humanitarian careers, sudden changes.',
                'IC': 'Unusual family background, innovative home, breaking family patterns.'
            },
            'Neptune': {
                'AC': 'Spirituality, intuition, creativity, possible confusion about identity.',
                'DC': 'Spiritual partnerships, idealistic relationships, possible deception.',
                'MC': 'Arts, spirituality, healing careers, unclear professional direction.',
                'IC': 'Spiritual family background, psychic sensitivity, unclear foundations.'
            },
            'Pluto': {
                'AC': 'Personal transformation, intensity, power, psychological depth.',
                'DC': 'Transformative relationships, power dynamics, intense partnerships.',
                'MC': 'Psychology, investigation, transformation careers, powerful reputation.',
                'IC': 'Family secrets, transformative home life, powerful ancestral influences.'
            }
        };

        function getJulianDay(date) {
            var year = date.getUTCFullYear();
            var month = date.getUTCMonth() + 1;
            var day = date.getUTCDate();
            var hour = date.getUTCHours();
            var minute = date.getUTCMinutes();
            var second = date.getUTCSeconds();

            var a = Math.floor((14 - month) / 12);
            var y = year + 4800 - a;
            var m = month + 12 * a - 3;

            var jdn = day + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
            
            var jd = jdn + (hour - 12) / 24 + minute / 1440 + second / 86400;
            
            return jd;
        }

        function getSiderealTime(jd, longitude) {
            var T = (jd - 2451545.0) / 36525.0;
            var theta0 = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 
                         0.000387933 * T * T - T * T * T / 38710000.0;
            
            theta0 = theta0 % 360;
            if (theta0 < 0) theta0 += 360;
            
            var lst = (theta0 + longitude) % 360;
            return lst;
        }

        function getPlanetPosition(planetName, jd) {
            var T = (jd - 2451545.0) / 36525.0;
            
            var positions = {
                'Sun': {
                    L: 280.46646 + 36000.76983 * T + 0.0003032 * T * T,
                    omega: 0,
                    e: 0.016708634 - 0.000042037 * T
                },
                'Moon': {
                    L: 218.3165 + 481267.8813 * T,
                    omega: 125.04 - 1934.136 * T,
                    e: 0.0549
                },
                'Mercury': {
                    L: 252.25 + 149472.68 * T,
                    omega: 48.33 + 1.186 * T,
                    e: 0.2056
                },
                'Venus': {
                    L: 181.98 + 58517.82 * T,
                    omega: 76.68 + 0.902 * T,
                    e: 0.0068
                },
                'Mars': {
                    L: 355.43 + 19140.30 * T,
                    omega: 49.56 + 0.772 * T,
                    e: 0.0934
                },
                'Jupiter': {
                    L: 34.35 + 3034.91 * T,
                    omega: 100.46 + 1.021 * T,
                    e: 0.0484
                },
                'Saturn': {
                    L: 50.08 + 1222.11 * T,
                    omega: 113.67 + 0.877 * T,
                    e: 0.0542
                },
                'Uranus': {
                    L: 314.05 + 428.48 * T,
                    omega: 74.01 + 0.521 * T,
                    e: 0.0463
                },
                'Neptune': {
                    L: 304.35 + 218.46 * T,
                    omega: 131.78 + 0.685 * T,
                    e: 0.0095
                },
                'Pluto': {
                    L: 238.96 + 145.18 * T,
                    omega: 110.30 + 0.387 * T,
                    e: 0.2488
                }
            };

            var planet = positions[planetName];
            if (!planet) return { ra: 0, dec: 0 };

            var L = planet.L % 360;
            if (L < 0) L += 360;

            var lambda = L;
            var beta = 0;
            
            var epsilon = 23.43928;
            var epsilonRad = epsilon * Math.PI / 180;
            var lambdaRad = lambda * Math.PI / 180;
            var betaRad = beta * Math.PI / 180;

            var raRad = Math.atan2(
                Math.sin(lambdaRad) * Math.cos(epsilonRad) - Math.tan(betaRad) * Math.sin(epsilonRad),
                Math.cos(lambdaRad)
            );
            var decRad = Math.asin(
                Math.sin(betaRad) * Math.cos(epsilonRad) + Math.cos(betaRad) * Math.sin(epsilonRad) * Math.sin(lambdaRad)
            );

            var ra = raRad * 180 / Math.PI;
            if (ra < 0) ra += 360;

            var dec = decRad * 180 / Math.PI;

            return { ra: ra, dec: dec };
        }

        function calculateAstrocartographyLine(planetPos, birthLat, lineType, lst) {
            var ra = planetPos.ra;
            var dec = planetPos.dec;
            var raRad = ra * Math.PI / 180;
            var decRad = dec * Math.PI / 180;
            var birthLatRad = birthLat * Math.PI / 180;
            
            var points = [];
            
            if (lineType === 'MC') {
                // MC line: where planet is at zenith (directly overhead)
                var longitude = (ra - lst + 360) % 360;
                if (longitude > 180) longitude -= 360;
                
                // MC lines are nearly vertical but still curve slightly
                for (var lat = -85; lat <= 85; lat += 5) {
                    var latRad = lat * Math.PI / 180;
                    var lonAdjustment = Math.sin(decRad) * Math.sin(latRad) * 2; // Small correction
                    var adjustedLon = longitude + lonAdjustment;
                    if (adjustedLon > 180) adjustedLon -= 360;
                    if (adjustedLon < -180) adjustedLon += 360;
                    points.push([lat, adjustedLon]);
                }
            } 
            else if (lineType === 'IC') {
                // IC line: opposite of MC
                var longitude = (ra - lst + 180) % 360;
                if (longitude > 180) longitude -= 360;
                
                for (var lat = -85; lat <= 85; lat += 5) {
                    var latRad = lat * Math.PI / 180;
                    var lonAdjustment = -Math.sin(decRad) * Math.sin(latRad) * 2;
                    var adjustedLon = longitude + lonAdjustment;
                    if (adjustedLon > 180) adjustedLon -= 360;
                    if (adjustedLon < -180) adjustedLon += 360;
                    points.push([lat, adjustedLon]);
                }
            }
            else if (lineType === 'AC' || lineType === 'DC') {
                // AC/DC lines: where planet rises/sets - these curve significantly
                for (var lat = -70; lat <= 70; lat += 2) {
                    var latRad = lat * Math.PI / 180;
                    
                    // Calculate hour angle for rising/setting
                    var cosH = -Math.tan(latRad) * Math.tan(decRad);
                    
                    if (Math.abs(cosH) <= 1) {
                        var H = Math.acos(Math.abs(cosH)) * 180 / Math.PI;
                        
                        var longitude;
                        if (lineType === 'AC') {
                            // Ascendant: planet rising in the east
                            longitude = (ra - H - lst + 360) % 360;
                        } else {
                            // Descendant: planet setting in the west  
                            longitude = (ra + H - lst + 360) % 360;
                        }
                        
                        if (longitude > 180) longitude -= 360;
                        
                        // Add curvature based on declination and latitude
                        var curvature = Math.sin(decRad) * Math.cos(latRad) * 5;
                        longitude += curvature;
                        
                        if (longitude > 180) longitude -= 360;
                        if (longitude < -180) longitude += 360;
                        
                        points.push([lat, longitude]);
                    }
                }
            }
            
            return points.length > 0 ? points : null;
        }

        function generateMap() {
            var dateStr = document.getElementById('birthDate').value;
            var timeStr = document.getElementById('birthTime').value;
            var lat = parseFloat(document.getElementById('birthLat').value);
            var lon = parseFloat(document.getElementById('birthLon').value);
            var tzOffset = parseFloat(document.getElementById('tzOffset').value);

            if (!dateStr || !timeStr || isNaN(lat) || isNaN(lon) || isNaN(tzOffset)) {
                alert('Please fill in all fields correctly');
                return;
            }

            for (var i = 0; i < currentLines.length; i++) {
                map.removeLayer(currentLines[i]);
            }
            currentLines = [];

            var dateParts = dateStr.split('-');
            var year = parseInt(dateParts[0]);
            var month = parseInt(dateParts[1]);
            var day = parseInt(dateParts[2]);
            
            var timeParts = timeStr.split(':');
            var hour = parseInt(timeParts[0]);
            var minute = parseInt(timeParts[1]);
            var second = timeParts[2] ? parseInt(timeParts[2]) : 0;

            var birthDate = new Date(Date.UTC(year, month - 1, day, hour - tzOffset, minute, second));
            
            var jd = getJulianDay(birthDate);
            var lst = getSiderealTime(jd, lon);

            var planetaryData = [];

            for (var i = 0; i < planets.length; i++) {
                var planet = planets[i];
                var planetPos = getPlanetPosition(planet.name, jd);
                
                for (var j = 0; j < lineTypes.length; j++) {
                    var lineType = lineTypes[j];
                    var linePoints = calculateAstrocartographyLine(planetPos, lat, lineType, lst);
                    
                    if (linePoints && linePoints.length > 0) {
                        var line = L.polyline(linePoints, {
                            color: planet.color,
                            weight: 3,
                            opacity: 0.7,
                            smoothFactor: 1.0
                        }).addTo(map);

                        var interpretation = interpretations[planet.name] && interpretations[planet.name][lineType] 
                            ? interpretations[planet.name][lineType] 
                            : 'This planetary line brings the energy of ' + planet.name + ' to this location.';
                        
                        var popupContent = '<div style="max-width: 250px;">' +
                            '<strong style="color: ' + planet.color + '; font-size: 1.1em;">' + planet.symbol + ' ' + planet.name + ' ' + lineType + '</strong><br><br>' +
                            '<div style="background: rgba(0,0,0,0.1); padding: 8px; border-radius: 4px; margin: 5px 0; font-size: 0.9em;">' +
                            interpretation + '</div>' +
                            '<div style="font-size: 0.8em; color: #666; margin-top: 8px;">' +
                            'RA: ' + planetPos.ra.toFixed(1) + '¬∞ | Dec: ' + planetPos.dec.toFixed(1) + '¬∞' +
                            '</div></div>';
                        
                        line.bindPopup(popupContent);

                        currentLines.push(line);
                        
                        // Add planet symbols along the line at key points
                        var symbolPositions = [];
                        if (linePoints.length > 10) {
                            var step = Math.floor(linePoints.length / 5);
                            for (var s = 0; s < linePoints.length; s += step) {
                                if (symbolPositions.length < 5) {
                                    symbolPositions.push(linePoints[s]);
                                }
                            }
                        } else {
                            symbolPositions = linePoints.slice(0, 3);
                        }
                        
                        var iconHtml = '<div style="font-size: 20px; color: ' + planet.color + '; text-shadow: 0 0 3px rgba(0,0,0,0.8), 0 0 6px rgba(0,0,0,0.5); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));">' + planet.symbol + '</div>';
                        var planetIcon = L.divIcon({
                            html: iconHtml,
                            className: 'planet-icon',
                            iconSize: [24, 24],
                            iconAnchor: [12, 12]
                        });
                        
                        for (var k = 0; k < symbolPositions.length; k++) {
                            var marker = L.marker(symbolPositions[k], {
                                icon: planetIcon
                            }).addTo(map);
                            
                            marker.bindPopup(popupContent);
                            currentLines.push(marker);
                        }
                        
                        planetaryData.push({
                            planet: planet.name,
                            symbol: planet.symbol,
                            color: planet.color
                        });
                    }
                }
            }

            var uniquePlanets = [];
            var seenPlanets = {};
            for (var k = 0; k < planetaryData.length; k++) {
                var p = planetaryData[k];
                if (!seenPlanets[p.planet]) {
                    uniquePlanets.push(p);
                    seenPlanets[p.planet] = true;
                }
            }
            
            var planetList = document.getElementById('planetList');
            var planetHTML = '';
            for (var m = 0; m < uniquePlanets.length; m++) {
                var planet = uniquePlanets[m];
                planetHTML += '<div class="planet-item" style="margin-bottom: 8px; display: flex; align-items: center; gap: 8px; font-size: 0.85rem;">' +
                    '<span style="color: ' + planet.color + '; font-size: 1.1rem;">' + planet.symbol + '</span>' +
                    '<span style="color: #fff;">' + planet.planet + '</span>' +
                '</div>';
            }
            planetList.innerHTML = planetHTML;

            document.getElementById('infoBox').style.display = 'block';
        }

        function toggleLegend() {
            var legend = document.getElementById('mapLegend');
            legend.style.display = legend.style.display === 'none' ? 'block' : 'none';
        }

        function geocodeLocation() {
            var location = document.getElementById('birthLocation').value.trim();
            if (!location) {
                alert('Please enter a location');
                return;
            }

            var geocodeUrl = 'https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(location) + '&limit=1';
            
            fetch(geocodeUrl)
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    if (data && data.length > 0) {
                        var lat = parseFloat(data[0].lat);
                        var lon = parseFloat(data[0].lon);
                        document.getElementById('birthLat').value = lat.toFixed(6);
                        document.getElementById('birthLon').value = lon.toFixed(6);
                        
                        var displayName = data[0].display_name.split(',').slice(0, 2).join(', ');
                        document.getElementById('birthLocation').value = displayName;
                        
                        generateMap();
                    } else {
                        alert('Location not found. Please try a different location or enter coordinates manually.');
                    }
                })
                .catch(function(error) {
                    console.error('Geocoding error:', error);
                    alert('Error finding location. Please enter coordinates manually.');
                });
        }

        function shareMap() {
            var params = new URLSearchParams();
            params.set('date', document.getElementById('birthDate').value);
            params.set('time', document.getElementById('birthTime').value);
            params.set('location', document.getElementById('birthLocation').value);
            params.set('lat', document.getElementById('birthLat').value);
            params.set('lon', document.getElementById('birthLon').value);
            params.set('tz', document.getElementById('tzOffset').value);
            
            var shareUrl = window.location.origin + window.location.pathname + '?' + params.toString();
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Astrocartography Map',
                    text: 'Check out my astrocartography map showing planetary lines around the world!',
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(shareUrl).then(function() {
                    alert('Map URL copied to clipboard! Share this link to show others your astrocartography map.');
                }).catch(function() {
                    prompt('Copy this URL to share your map:', shareUrl);
                });
            }
        }

        function loadFromUrl() {
            var urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.get('date')) document.getElementById('birthDate').value = urlParams.get('date');
            if (urlParams.get('time')) document.getElementById('birthTime').value = urlParams.get('time');
            if (urlParams.get('location')) document.getElementById('birthLocation').value = urlParams.get('location');
            if (urlParams.get('lat')) document.getElementById('birthLat').value = urlParams.get('lat');
            if (urlParams.get('lon')) document.getElementById('birthLon').value = urlParams.get('lon');
            if (urlParams.get('tz')) document.getElementById('tzOffset').value = urlParams.get('tz');
            
            if (urlParams.has('date') && urlParams.has('time')) {
                setTimeout(generateMap, 500);
            }
        }

        document.getElementById('birthLocation').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                geocodeLocation();
            }
        });

        window.addEventListener('load', function() {
            loadFromUrl();
        });
    </script>
</body>
</html>