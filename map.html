<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Astrology Map | LocationalAstro</title>
    <meta name="description" content="View your personalized astrology map with planetary lines showing cosmic influences worldwide.">
    <meta name="keywords" content="astrocartography, location astrology, birth chart, planetary lines, astrology map">
    <meta name="author" content="LocationalAstro">
    <meta name="robots" content="noindex, nofollow">\n    \n    <!-- Open Graph / Facebook Meta Tags -->\n    <meta property="og:type" content="website">\n    <meta property="og:title" content="Your Astrology Map | LocationalAstro">\n    <meta property="og:description" content="View your personalized astrology map with planetary lines showing cosmic influences worldwide.">\n    <meta property="og:image" content="https://locationalastro.com/images/logo-large.png">\n    <meta property="og:url" content="https://locationalastro.com/map.html">\n    <meta property="og:site_name" content="LocationalAstro">\n    <meta property="og:locale" content="en_US">\n    \n    <!-- Twitter Card Meta Tags -->\n    <meta name="twitter:card" content="summary_large_image">\n    <meta name="twitter:title" content="Your Astrology Map | LocationalAstro">\n    <meta name="twitter:description" content="View your personalized astrology map with planetary lines.">\n    <meta name="twitter:image" content="https://locationalastro.com/images/logo-large.png">\n    <meta name="twitter:site" content="@locationalastro">"
    
    <!-- Favicon and Logo Meta Tags -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="theme-color" content="#0a0a1a">
    
    <!-- Fonts and Stylesheets -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="styles.css" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-652WT4X6XV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-652WT4X6XV');
    </script>
</head>
<body class="map-page">
    <!-- Navigation Header -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <img src="images/logo-small.png" alt="LocationalAstro" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline'">
                <span class="logo-fallback" style="display:none">âœ¨</span>
                <span class="brand-text">LocationalAstro</span>
            </a>
            <div class="nav-links">
                <div class="birth-data-inline">
                    <div class="data-grid" id="dataGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    <div class="horoscope-info" id="horoscopeInfo">
                        <!-- Will be populated with sun/moon/rising signs -->
                    </div>
                </div>
                <button id="saveMapBtn" class="save-icon-btn" title="Save map as image" style="display: none;">ðŸ’¾</button>
                <button id="newMapBtn" class="nav-link-button" title="Create new map">ðŸ†•</button>
            </div>
        </div>
    </nav>

    <!-- Map Display Section -->
    <section class="map-display-section">
        <div class="container-full">
            <div class="map-stage" id="map-stage">
                <div id="map" class="astro-map"></div>

                <!-- Sliding Legend Panel -->
                <div class="legend-slider" id="legendSlider">
                    <div class="legend-toggle" id="legendToggle">
                        <span class="arrow-icon">â–º</span>
                    </div>
                    <div class="legend-panel" id="legendPanel">
                        <div class="legend-grid">
                            <div class="line-type" title="Ascendant line - Where planets are rising on the eastern horizon. Represents new beginnings, identity, and how you appear to others when this planet's energy is emphasized."><strong>AC</strong><span>Rising line</span></div>
                            <div class="line-type" title="Descendant line - Where planets are setting on the western horizon. Represents partnerships, relationships, and how others perceive you when this planet's energy is emphasized."><strong>DC</strong><span>Setting line</span></div>
                            <div class="line-type" title="Midheaven line - Where planets are at their highest point in the sky. Represents career, reputation, public image, and life direction when this planet's energy is emphasized."><strong>MC</strong><span>Overhead line</span></div>
                            <div class="line-type" title="Imum Coeli line - Where planets are at their lowest point in the sky. Represents home, family, roots, and your private/inner world when this planet's energy is emphasized."><strong>IC</strong><span>Underfoot line</span></div>
                        </div>
                        <div class="planet-list" id="planetList"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Hidden form for data persistence -->
    <div style="display: none;">
        <input type="date" id="birthDate">
        <input type="time" id="birthTime">
        <input type="text" id="birthLocation">
        <input type="number" id="birthLat">
        <input type="number" id="birthLon">
        <input type="text" id="tzDisplay">
        <input type="hidden" id="tzOffset">
        <select id="coordinateSystem">
            <option value="mundo">Mundo (Local Space)</option>
            <option value="zodio">Zodio (Alternative)</option>
        </select>
    </div>

    <!-- Scripts -->
    <!-- Emergency brake - MUST run before script.js -->
    <script>
        // Use more robust path detection for local files
        var isMapPage = window.location.href.includes('map.html') || window.location.pathname.includes('map.html');
        
        if (isMapPage) {
            window.mapPageInitialized = true;
            window.isGeneratingMap = true;
            
            // Safety timeout to reset generating flag
            setTimeout(function() {
                window.isGeneratingMap = false;
            }, 3000);
        }
    </script>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
    <script src="https://unpkg.com/leaflet-image@0.4.0/leaflet-image.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Clean HTML - All JavaScript logic moved to script.js
    </script>
</body>
</html>